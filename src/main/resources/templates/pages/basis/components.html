<!doctype html>
<html lang="ja" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
</head>

<body>
  <main>
  <div th:fragment="header(contentsTitle)">
    <header style="margin-top: 3px; margin-bottom: 3px; border-left: 3px solid #7386D5;">
      <div>
        <nav class="navbar navbar-default">
          <div class="navbar-header">
            <span class="pageTitle" th:text="${contentsTitle}"></span>
          </div>
        </nav>
      </div>
    </header>
  </div>

  <div th:fragment="contentsHeader"></div>
  <!--/* ダイアログメッセージ */-->
  <div th:fragment="dialogMessages">
    <dialogMessages>
      <input type="hidden" id="appCompleteMessageSuccess" th:value='${appCompleteMessageSuccess}' />
      <input type="hidden" id="appCompleteMessageWarning"th:value='${appCompleteMessageWarning}' />
      <input type="hidden" id="appCompleteMessageFailure" th:value='${appCompleteMessageFailure}' />
    </dialogMessages>
  </div>
  <!--/* サイドメニュー */-->
  <div th:fragment="sideMenu">
      <div class="wrapper hidden" id="sideMenu">
        <!-- Sidebar Holder -->
        <nav id="sidebar" class="bg-dark">
          <div class="sidebar-header bg-dark" style="border-bottom: solid 1px grey; padding-right: 10px;">
            <a class="text-decoration-none text-light" th:href="@{/home}">
              <img th:src="@{/images/logo.png}" alt="logo" class="rounded-circle" width="42em" height="32em" style="opacity: .6" />
              <span id="title" class="ml-1 headline" title="稼働状況管理"></span>
            </a>
          </div>
          <div class="text-right" style="padding: 3px;">
            <button type="button" id="sidebarCollapse" class="btn btn-dark navbar-btn" style="line-height: 1;">
              <i class="fas fa-bars"></i>
            </button>
          </div>
          <ul class="list-unstyled components"
            th:with="uri       = ${#httpServletRequest.requestURI}
                     , isMente = ${#strings.contains(uri, '__@{/maintenance/users/}__')}
                     , bgColor = '#dc9edc;'
                     , home            = @{/home}
                     , staffs        = @{/staffs}
                     , clients        = @{/clients}
                     , bill_adresses = @{/bill_adresses}
                     , projects      = @{/projects}
                     , users         = @{/maintenance/users/search?roleName=ALL&nonIsInvalid=on}
                     ">
            <li th:unless="${isMente}" th:with="bg=${#strings.contains(uri, home) ? bgColor : '' }" th:style="'background-color:' + ${bg}">
              <a th:href="${home}">
                <i class="fas fa-fw fa-home"></i> Home
              </a>
            </li>
            <li th:unless="${isMente}" th:with="bg=${#strings.contains(uri, staffs) ? bgColor : '' }" th:style="'background-color:' + ${bg}">
              <a th:href="${staffs}">
                <i class="fas fa-fw fa-address-card"></i> スタッフ管理
              </a>
            </li>
            <li th:unless="${isMente}" th:with="bg=${#strings.contains(uri, clients) ? bgColor : '' }" th:style="'background-color:' + ${bg}">
              <a th:href="${clients}">
                <i class="fas fa-fw fa-building"></i> 取引先管理
              </a>
            </li>
            <li th:unless="${isMente}" th:with="bg=${#strings.contains(uri, bill_adresses) ? bgColor : '' }" th:style="'background-color:' + ${bg}">
              <a th:href="${bill_adresses}">
                <i class="far fa-fw fa-file"></i> 請求先管理
              </a>
            </li>
            <li th:unless="${isMente}" th:with="bg=${#strings.contains(uri, projects) ? bgColor : '' }" th:style="'background-color:' + ${bg}">
              <a th:href="${projects}">
                <i class="fas fa-fw fa-list-alt"></i> 案件管理
              </a>
            </li>
            <li th:if="${isMente}" th:with="bg=${bgColor}" th:style="'background-color:' + ${bg}">
              <a th:href="${users}">
                <i class="fas fa-fw fa-list-alt"></i> ユーザ管理
              </a>
            </li>
          </ul>
          <ul class="list-unstyled">
            <li>
              <a th:href="@{/index}">
                <i class="far fa-fw fa-arrow-alt-circle-left" style="padding-right: 5px;"></i>戻る
              </a>
            </li>
          </ul>
          <ul class="list-unstyled ctas">
            <li>
              <a class="article text-center font-weight-bold" href="javascript:App.logout();">ログアウト</a>
            </li>
          </ul>
        </nav>
      </div>
      <script type="text/javascript">
        $(document).ready(() => {
          $(() => {
            const storage = localStorage;
            const isActive = storage.getItem('sidebar');
            if (isActive=='true') {
              $('#sidebar').toggleClass('active');
            }
            $('#sideMenu').show();
          });
          $('#sidebarCollapse').on('click', () => {
            $('#sideMenu').hide();
            $('#sidebar, #content').toggleClass('active');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
            const storage = localStorage;
            const isActive = $('#sidebar').hasClass('active');
            storage.setItem('sidebar', isActive);
            fade();
            $('#sideMenu').fadeIn('slow');
          });
          fade();
        });
        const fade = () => {
          const $allMsg = $('#title');
          const $wordList = $('#title').attr('title').split('');
          $('#title').html("");
          $.each($wordList, (idx, elem) => {
              const newEL = $('<span>').text(elem).css({ opacity: 0 });
              newEL.appendTo($allMsg);
              newEL.delay(idx * 70);
              newEL.animate({ opacity: 1 }, 1100);
            });
          };
          
          
      </script>
      <style>
        .hidden{
           display:none;   
        }
      </style>
    </div>
  </main>
</body>
</html>
